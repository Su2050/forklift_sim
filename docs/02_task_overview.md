# 任务概览：这个仿真环境里有什么？要做成什么样算成功？

本页适合：能跑起来但想理解“这项任务到底在做什么”的读者。

---

## 1. 任务边界（你在训练什么，不训练什么）

这项任务名叫 **Forklift Pallet Insert + Lift**，训练目标是：

- 叉车从托盘前方一定距离随机出生
- 驶向托盘并对准
- 将货叉插入托盘孔位（以“插入深度”衡量）
- 抬升到指定高度，并保持一段时间

刻意**不包含**的内容（也就是别指望模型学会这些）：

- 长距离导航（地图、障碍绕行）
- 托盘搬运、放置、堆叠
- 多物体交互（货物、货架、墙、行人）

---

## 2. 仿真环境里有哪些物体（以及它们各自的作用）

环境的场景非常“极简”，主要就是为了让强化学习先把核心动作学会。

### 2.1 叉车机器人（可控对象）

- **类型**：关节机构（Articulation）
- **资产**：`ForkliftC/forklift_c.usd`
- **你控制它的方式**：给轮子/转向/升降关节下发目标（速度或位置）

叉车关键关节（名字来自环境实现）：

- 前轮：`left_front_wheel_joint`、`right_front_wheel_joint`（速度控制）
- 后轮：`left_back_wheel_joint`、`right_back_wheel_joint`（速度控制）
- 转向：`left_rotator_joint`、`right_rotator_joint`（位置控制）
- 升降：`lift_joint`（速度控制）

#### 叉车执行器配置参数

| 执行器组 | 关节 | 控制方式 | stiffness | damping | velocity_limit | effort_limit |
|----------|------|----------|-----------|---------|----------------|--------------|
| `front_wheels` | 前轮 | 速度 | 0.0 | 100.0 | 40.0 rad/s | 200 N·m |
| `back_wheels` | 后轮 | 速度 | 0.0 | 50.0 | 40.0 rad/s | 200 N·m |
| `rotators` | 转向 | 位置 | 4000.0 | 400.0 | 10.0 rad/s | 300 N·m |
| `lift` | 升降 | 速度 | 2000.0 | 200.0 | 1.0 m/s | 500 N |

#### 叉车刚体物理属性

| 属性 | 值 | 说明 |
|------|-----|------|
| density | 3000.0 kg/m³ | 质量密度 |
| max_linear_velocity | 20.0 m/s | 最大线速度 |
| max_angular_velocity | 20.0 rad/s | 最大角速度 |
| max_depenetration_velocity | 5.0 m/s | 最大穿透恢复速度 |
| enable_gyroscopic_forces | True | 启用陀螺力 |

> 配置详见 `env_cfg.py` 第 77-145 行

### 2.2 托盘（任务目标参照物）

- **类型**：刚体对象（RigidObject）
- **资产**：`Props/Pallet/pallet.usd`
- **关键设定**：默认是 **kinematic（运动学物体）**，也就是**固定不动**（更稳定，更容易学）

#### 托盘物理属性

| 属性 | 值 | 说明 |
|------|-----|------|
| kinematic_enabled | True | 运动学模式（固定不动） |
| disable_gravity | True | 禁用重力 |
| max_depenetration_velocity | 1.0 m/s | 最大穿透恢复速度 |
| pallet_depth | 1.2 m | 托盘深度（欧标托盘） |
| 初始位置 | (0, 0, 0) | 世界坐标原点 |

> 配置详见 `env_cfg.py` 第 147-163 行

为什么托盘要固定？

- 新手阶段，先让策略专注"对准/插入/抬升"，避免托盘乱动导致奖励噪声太大
- 等策略稳定后，可以再把托盘改成动态、可受力（属于进阶改造）

### 2.3 地面（碰撞支撑面）

- **类型**：Ground plane（地面平面）
- **作用**：给叉车轮胎提供接触与摩擦，不然车会“掉下去”或碰撞不真实

### 2.4 灯光（仅视觉呈现）

- **类型**：DomeLight（圆顶灯）
- **作用**：照亮场景，便于可视化/录视频；对训练逻辑本身通常无影响

### 2.5 仿真参数

| 参数 | 值 | 说明 |
|------|-----|------|
| physics_dt | 1/120 s | 物理仿真时间步 |
| decimation | 4 | 控制频率 = physics_dt × decimation |
| render_interval | 4 | 渲染间隔 |
| env_spacing | 6.0 m | 并行环境间距 |
| num_envs | 128 | 默认并行环境数量 |

> 配置详见 `env_cfg.py` 第 18-40 行

---

## 3. 叉车从哪里开始？托盘在哪里？

### 3.1 托盘初始位置（固定）

- 托盘在世界坐标原点附近（默认 `(0, 0, 0)`）

### 3.2 叉车初始位置（随机）

每个 episode 会把叉车随机放到托盘前方一段区域：

- x 在 `[-2.5, -1.0]`（大概在托盘前方 1–2.5m）
- y 在 `[-0.6, 0.6]`（左右偏移）
- yaw 在 `[-0.25, 0.25]` 弧度（大约 ±14°）

这样做的目的是：让策略别只会一个固定起点，而是能“在一定范围内泛化”。

---

## 4. 什么叫“成功”？（任务 KPI）

成功需要同时满足三件事，并且要**连续保持**一段时间：

- **插入够深**：货叉插入深度 ≥ 托盘深度的 \(2/3\)
- **对齐够准**：
  - 横向误差（左右） ≤ 3cm
  - 偏航误差（朝向差） ≤ 3°
- **抬升够高**：相对初始货叉高度抬升 ≥ 0.12m
- **保持时间**：满足以上条件并持续约 1 秒（避免“碰巧撞到一下就算成功”）

---

## 5. 什么时候会失败/结束？

episode 会在以下情况结束：

- **成功**：达到并保持 KPI
- **超时**：episode 时长达到上限（默认 45 秒）
- **倾翻**：叉车 roll 或 pitch 超过阈值（约 25°）

---

## 6. 下一步读什么

- 想看“动作/观测/奖励到底怎么设计”：`docs/03_task_design_rl.md`

